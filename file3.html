<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Canvas Shooter Game</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #111; }
    canvas { display: block; margin: 0 auto; background: #222; }
    #overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; align-items: center; justify-content: center;
      flex-direction: column; color: #fff; font: 2rem sans-serif;
      background: rgba(0,0,0,0.7); visibility: hidden;
    }
    #overlay button {
      margin-top: 1rem; padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="overlay">
    <div id="msg">Game Over</div>
    <button id="restart">Restart</button>
  </div>

  <script>  
(function() {
    const canvas = document.getElementById('game');
    const ctx    = canvas.getContext('2d');
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;

    // Game state
    let keys = {}, bullets = [], enemies = [], score = 0, gameOver = false, animId;

    // Player
    const player = {
      x: canvas.width/2, y: canvas.height - 60, w: 40, h: 40, speed: 5
    };

    // Input handlers
    window.addEventListener('keydown', e => { keys[e.code] = true; });
    window.addEventListener('keyup',   e => { keys[e.code] = false; });
    window.addEventListener('resize',  () => {
      canvas.width = window.innerWidth;
      canvas.height= window.innerHeight;
    });

    // Shoot bullets
    function shoot() {
      bullets.push({ x: player.x + player.w/2 - 5, y: player.y, w:10, h:20, speed:8 });
    }
    window.addEventListener('keydown', e => {
      if (e.code === 'Space' && !gameOver) shoot();
    });

    // Spawn enemies periodically
    let enemyTimer = 0;
    function spawnEnemy() {
      const size = 30 + Math.random()*20;
      enemies.push({
        x: Math.random()*(canvas.width - size),
        y: -size,
        w: size, h: size,
        speed: 2 + Math.random()*2
      });
    }

    // Collision check
    function isColliding(a, b) {
      return a.x < b.x + b.w && a.x + a.w > b.x &&
             a.y < b.y + b.h && a.y + a.h > b.y;
    }

    // Main loop
    function loop() {
      if (gameOver) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Move player
      if (keys.ArrowLeft || keys.KeyA)  player.x -= player.speed;
      if (keys.ArrowRight|| keys.KeyD)  player.x += player.speed;
      if (keys.ArrowUp   || keys.KeyW)  player.y -= player.speed;
      if (keys.ArrowDown || keys.KeyS)  player.y += player.speed;
      // Clamp within canvas
      player.x = Math.max(0, Math.min(canvas.width - player.w, player.x));
      player.y = Math.max(0, Math.min(canvas.height - player.h, player.y));

      // Draw player
      ctx.fillStyle = '#0f0';
      ctx.fillRect(player.x, player.y, player.w, player.h);

      // Update & draw bullets
      bullets = bullets.filter(b => b.y + b.h > 0);
      bullets.forEach(b => {
        b.y -= b.speed;
        ctx.fillStyle = '#ff0';
        ctx.fillRect(b.x, b.y, b.w, b.h);
      });

      // Spawn enemies
      enemyTimer++;
      if (enemyTimer > 60) { spawnEnemy(); enemyTimer = 0; }

      // Update & draw enemies
      enemies = enemies.filter(e => e.y < canvas.height);
      enemies.forEach((e,i) => {
        e.y += e.speed;
        ctx.fillStyle = '#f00';
        ctx.fillRect(e.x, e.y, e.w, e.h);

        // Check collision with player
        if (isColliding(e, player)) endGame();

        // Check collision with bullets
        bullets.forEach((b,j) => {
          if (isColliding(b, e)) {
            bullets.splice(j,1);
            enemies.splice(i,1);
            score += 10;
          }
        });
      });

      // Draw score
      ctx.fillStyle = '#fff';
      ctx.font = '20px sans-serif';
      ctx.fillText('Score: ' + score, 20, 30);

      animId = requestAnimationFrame(loop);
    }

    // Game over
    const overlay = document.getElementById('overlay');
    const msg     = document.getElementById('msg');
    function endGame() {
      gameOver = true;
      cancelAnimationFrame(animId);
      msg.textContent = 'Game Over\nScore: ' + score;
      overlay.style.visibility = 'visible';
    }

    // Restart
    document.getElementById('restart').onclick = () => {
      // Reset state
      bullets = []; enemies = []; score = 0; gameOver = false; enemyTimer = 0;
      player.x = canvas.width/2; player.y = canvas.height-60;
      overlay.style.visibility = 'hidden';
      loop();
    };

    // Start
    loop();
  })();
  </script>
</body>
</html>
